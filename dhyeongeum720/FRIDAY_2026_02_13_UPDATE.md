# κΈμ”μΌ μ—…λ°μ΄νΈ μ”μ•½

**λ‚ μ§:** 2026λ…„ 2μ›” 13μΌ κΈμ”μΌ
**μ”μ²­:** λ¬µμ‘μ΄ μ”μ²­ν• Home Assistant μ—°κΈλ³µκ¶ 720+ μ• λ“μ¨ μ‘μ—… μ΄μ–΄μ„ μ§„ν–‰

---

## μ™„λ£λ μ‘μ—…

### 1. Step 3 μΊ΅μ² κ°€μ΄λ“ μ‘μ„± β…

νμΌ: `STEP3_CAPTURE_GUIDE.md`

- Chrome DevTools μ‚¬μ© λ°©λ²•
- Network νƒ­ μΊ΅μ² λ‹¨κ³„
- Step 3μ—μ„ μΊ΅μ²ν•  μ •λ³΄ (Request Headers, Payload, Response)
- μ„±κ³µ/μ‹¤ν¨ μ‹λ‚λ¦¬μ¤ μμ‹
- μ¤ν¬λ¦°μƒ· μΊ΅μ² κ°€μ΄λ“

---

### 2. dh_pension_720.py μ—…λ°μ΄νΈ β…

νμΌ: `dh_pension_720.py`

**Step 1 & 2 μ¤ν… κµ¬ν„:**
- `makeOrderNo.do` β†’ `{"q": "..."}` μ”μ²­/μ‘λ‹µ μ¤ν…
- `connPro.do` β†’ `{"q": "..."}` μ”μ²­/μ‘λ‹µ μ¤ν…

**Step 3 (μµμΆ… κµ¬λ§¤ ν™•μ •) κµ¬ν„:**
- μ—”λ“ν¬μΈνΈ: `confirmPurchase.do` (μμƒ, μ‹¤μ  μ΄λ¦„ ν™•μΈ ν•„μ”)
- Payload: `{"q": "<encrypted_blob>"}` (Step 2μ μ‘λ‹µ μ‚¬μ©)
- Response μ²λ¦¬:
  - μ„±κ³µ μ½”λ“: `"10000"`
  - μ‹¤ν¨ μ½”λ“: `"20001"` (μ”μ•΅ λ¶€μ΅±), `"20002"` (μ΄λ―Έ κµ¬λ§¤)
- `DhPension720BuyData` λ°ν™ (νμ°¨, λ°ν–‰μΌμ‹, λ°”μ½”λ“, μ¥μ, κΈμ•΅)

**TODO:** RSA μ•”νΈν™” λ΅μ§ κµ¬ν„ (`dh_rsa.py`)

---

## λ‚¨μ€ μ‘μ—…

### π”΄ μµμ°μ„ : Step 3 λ„¤νΈμ›ν¬ μΊ΅μ²

**μ‚¬μ©μκ°€ ν•΄μ•Ό ν•  κ²ƒ:**
1. Chromeμ—μ„ `https://ol.dhlottery.co.kr/` μ ‘μ†
2. F12 β†’ Network νƒ­ (XHR ν•„ν„°)
3. λ΅κ·ΈμΈ β†’ μ—°κΈλ³µκ¶ 720+ β†’ κµ¬λ§¤ μ§„ν–‰
4. `connPro.do` λ‹¤μμ— νΈμ¶λλ” μ”μ²­ μ°ΎκΈ°
5. Request/Response μΊ΅μ² (μ¤ν¬λ¦°μƒ·)

**μΊ΅μ²ν•  μ •λ³΄:**
- [ ] μ”μ²­ URL (`?????.do`)
- [ ] Request Payload ν‚¤ λ©λ΅
- [ ] Response μ„±κ³µ/μ‹¤ν¨ μ½”λ“
- [ ] Response λ©”μ‹μ§€ κµ¬μ΅°

**κ°€μ΄λ“:** `STEP3_CAPTURE_GUIDE.md` μ°Έμ΅°

---

### λ‹¤μ λ‹¨κ³„ (μΊ΅μ² μ™„λ£ ν›„)

1. **dh_pension_720.py μ—…λ°μ΄νΈ:**
   - Step 3 μ‹¤μ  μ—”λ“ν¬μΈνΈ μ΄λ¦„ μ μ©
   - Payload κµ¬μ΅° μμ • (ν•„μ”ν• κ²½μ°)
   - Response μ½”λ“/λ©”μ‹μ§€ λ§¤ν•‘

2. **RSA μ•”νΈν™” λ΅μ§ κµ¬ν„:**
   - `dh_rsa.py`μ—μ„ μ•”νΈν™”/λ³µνΈν™” ν•¨μ κµ¬ν„
   - q κ°’ μƒμ„±/νμ‹± ν•¨μ
   - Step 1/2/3μ q κ°’ μ²λ¦¬ λ΅μ§

3. **λ΅κ·ΈμΈ κΈ°λ¥ κµ¬ν„:**
   - μ„Έμ…/μΏ ν‚¤ κ΄€λ¦¬
   - μ‚¬μ©μ μΈμ¦

4. **ν…μ¤νΈ:**
   - μ‹¤μ  κµ¬λ§¤ ν…μ¤νΈ (1μ¥, 5μ¥)
   - μ—λ¬ μ²λ¦¬ ν…μ¤νΈ

---

## μ¤μΊν΄λ”© μƒνƒ

### μ™„μ „ β…

- **FastAPI κ³¨κ²©:** main.py
- **REST μ—”λ“ν¬μΈνΈ:**
  - `GET /health`
  - `GET /accounts`
  - `POST /api/purchase/{username}/{count}`
  - `GET /api/balance/{username}`
  - `GET /api/history/{username}`

- **Home Assistant μ—°λ™:**
  - MQTT Auto Discovery (μ„Όμ„, λ²„νΌ μλ™ μƒμ„±)
  - λ²„νΌ: 1μ¥ κµ¬λ§¤, 5μ¥ κµ¬λ§¤
  - μ„Όμ„: μ”μ•΅, λ΅κ·ΈμΈ μƒνƒ, κµ¬λ§¤ μ΄λ ¥
  - Ingress UI (ν¬νΈ 60100)

- **DH Lottery ν΄λΌμ΄μ–ΈνΈ:**
  - `dh_lottery_client.py` (HTTP ν΄λΌμ΄μ–ΈνΈ)
  - `dh_pension_720.py` (μ—°κΈλ³µκ¶ 720+ λ΅μ§)
  - `dh_rsa.py` (RSA μ•”νΈν™”)

- **λ¬Έμ„:**
  - README.md
  - DOCS.md
  - NETWORK_ANALYSIS.md
  - STEP3_CAPTURE_GUIDE.md
  - TESTING.md
  - CHECKLIST.md

---

## λ„¤νΈμ›ν¬ νλ¦„ μ •λ¦¬

### ν„μ¬ ν™•λ³΄λ μ •λ³΄

| Step | μ—”λ“ν¬μΈνΈ | μƒνƒ |
|------|-----------|------|
| 1 | `makeOrderNo.do` | β… ν™•μΈ |
| 2 | `connPro.do` | β… ν™•μΈ |
| 3 | `?????.do` | π”΄ μΊ΅μ² ν•„μ” |

### Step 3 μμƒ κµ¬μ΅°

**μ”μ²­:**
```
POST https://ol.dhlottery.co.kr/servlet/pension720/confirmPurchase.do
Content-Type: application/x-www-form-urlencoded

q=<encrypted_blob>
```

**μ‘λ‹µ (μ„±κ³µ):**
```json
{
  "returnCode": "10000",
  "returnMsg": "κµ¬λ§¤ μ™„λ£",
  "data": {
    "roundNo": 1234,
    "issueDt": "2026/02/13 κΈ 09:00:00",
    "barcode": "1234 5678 1234 5678 1234 5678",
    "ticketCount": 1,
    "amount": 1000
  }
}
```

**μ‘λ‹µ (μ‹¤ν¨ - μ”μ•΅ λ¶€μ΅±):**
```json
{
  "returnCode": "20001",
  "returnMsg": "μ”μ•΅μ΄ λ¶€μ΅±ν•©λ‹λ‹¤",
  "data": null
}
```

---

## λ‹¤μ μ£Όμ— ν•  κ²ƒ

1. ~~Step 3 λ„¤νΈμ›ν¬ μΊ΅μ²~~ (μ‚¬μ©μκ°€ Chrome DevToolsλ΅ μ§„ν–‰)
2. dh_rsa.pyμ—μ„ RSA μ•”νΈν™” λ΅μ§ κµ¬ν„
3. λ΅κ·ΈμΈ κΈ°λ¥ κµ¬ν„
4. μ‹¤μ  κµ¬λ§¤ ν…μ¤νΈ
5. μ—λ¬ μ²λ¦¬ λ° λ΅κ·Έ κ°μ„ 

---

## μ°Έκ³ 

- μ• λ“μ¨ μ΄λ¦„/μ¬λ¬κ·Έ: `dhyeongeum720`
- ν¬νΈ: 8099 (API), 60100 (Ingress UI)
- Python λ²„μ „: 3.12
- HA μ§€μ› μ•„ν‚¤ν…μ²: aarch64, amd64, armv7

---

## μ§λ¬Έ?

Step 3 μΊ΅μ² μ™„λ£ ν›„ μ •λ³΄λ¥Ό μ•λ ¤μ£Όμ‹λ©΄ μ½”λ“λ¥Ό λ°”λ΅ μ—…λ°μ΄νΈν•κ² μµλ‹λ‹¤!
